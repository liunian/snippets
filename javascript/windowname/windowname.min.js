function Transfer(e,a,b){this.url=e;this.callback=a;b.localProxy=b.localProxy||"/favicon.ico";b.defaultName="cross.default.name";this.options=b||{};this.init()}
Transfer.prototype={init:function(){this.params=this.options.params||{};this.params.windowname=1;delete this.options.params;this.files=this.options.files||[];delete this.options.files;var e="transfer_"+(new Date).getTime(),a;a=null;try{a=document.createElement('<iframe name="'+e+'">')}catch(b){}if(!a||"IFRAME"!=a.nodeName)a=document.createElement("iframe"),a.name=e;a.name=e;a.style.display="none";a.style.position="fixed";a.style.top=a.style.left="-10000px";document.body.appendChild(a);var c=document.createElement("form");
c.style.display="none";c.target=e;c.action=this.url;c.method="post";c.enctype="application/x-www-form-urlencoded";document.body.appendChild(c);this.frame=a;this.form=c;this.state=1;this._setRequest()},_setRequest:function(){function e(){try{if("about:blank"==b.contentWindow.location.href)return}catch(e){}if(3==a.state){var d=!1;try{d=b.contentWindow.location.host==location.host}catch(h){}if(d){if(b.readyState&&"complete"!=b.readyState.toLowerCase())return;d=b.contentWindow.name;d==g.defaultName&&
(d='{"error": 1}');a.callback(d);b.onreadystatechange=b.onload=null;b.parentNode.removeChild(b);if(c){for(var i=0,k=a._files.length;i<k;i++)d=a._files[i],d[2].insertBefore(d[0],d[1]),d[2].removeChild(d[1]);a._files=[];c.parentNode.removeChild(c)}}else b.contentWindow.location=f}2==a.state&&(b.contentWindow.location=f,a.state=3)}var a=this,b=a.frame,c=a.form,g=a.options,f=g.localProxy;void 0!==b.onreadystatechange?b.onreadystatechange=e:b.onload=e},send:function(){function e(a,b){var c=document.createElement("input");
c.name=a;c.value=b;return c}var a=this.params,b=this.files,c=this.form,g,f,j=Object.prototype.toString;for(g in a)if(a.hasOwnProperty(g))if(f=a[g],"[object Array]"===j.call(f))for(var d=g+"[]",h=0,i=f.length;h<i;h++)c.appendChild(e(d,f[h]));else c.appendChild(e(g,f));j=this._files=[];d=b.length;if(0<d){c.enctype="multipart/form-data";for(h=0;h<d;h++)a=b[h],g=a.parentNode,f=a.cloneNode(),f.disabled="disabled",j.push([a,f,g]),g.insertBefore(f,a),c.appendChild(a)}c.submit();this.state=2;this.frame.contentWindow&&
(this.frame.contentWindow.name=this.options.defaultName)}};
