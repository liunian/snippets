function Transfer(d,a,c){this.url=d;this.callback=a;this.options=this.extend({localProxy:"/favicon.ico",defaultName:"cross.default.name"},c);this.init()}
Transfer.prototype={init:function(){this.params=this.options.params||{};this.params.windowname=1;delete this.options.params;this.files=this.options.files||[];delete this.options.files;var d="transfer_"+(new Date).getTime(),a;a=null;try{a=document.createElement('<iframe name="'+d+'">')}catch(c){}if(!a||"IFRAME"!=a.nodeName)a=document.createElement("iframe"),a.name=d;a.name=d;a.style.display="none";a.style.position="fixed";a.style.top=a.style.left="-10000px";document.body.appendChild(a);var b=document.createElement("form");
b.style.display="none";b.target=d;b.action=this.url;b.method="post";b.enctype="application/x-www-form-urlencoded";document.body.appendChild(b);this.frame=a;this.form=b;this.state=1;this._setRequest()},_setRequest:function(){function d(){try{if("about:blank"==c.contentWindow.location.href)return}catch(d){}if(3==a.state){var f=!1;try{f=c.contentWindow.location.host==location.host}catch(h){}if(f){if(c.readyState&&"complete"!=c.readyState.toLowerCase())return;f=c.contentWindow.name;f==e.defaultName&&
(f='{"error": 1}');a.callback(f);c.onreadystatechange=c.onload=null;c.parentNode.removeChild(c);if(b){for(var i=0,l=a._files.length;i<l;i++)f=a._files[i],f[2].insertBefore(f[0],f[1]),f[2].removeChild(f[1]);a._files=[];b.parentNode.removeChild(b)}b=c=null;for(var k in a)a.hasOwnProperty(k)&&(a[k]=null,delete a[k])}else c.contentWindow.location=g}2==a.state&&(c.contentWindow.location=g,a.state=3)}var a=this,c=a.frame,b=a.form,e=a.options,g=e.localProxy;void 0!==c.onreadystatechange?c.onreadystatechange=
d:c.onload=d},send:function(){function d(a,c){var b=document.createElement("input");b.name=a;b.value=c;return b}var a=this.params,c=this.files,b=this.form,e,g,j=Object.prototype.toString;for(e in a)if(a.hasOwnProperty(e))if(g=a[e],"[object Array]"===j.call(g))for(var f=e+"[]",h=0,i=g.length;h<i;h++)b.appendChild(d(f,g[h]));else b.appendChild(d(e,g));j=this._files=[];f=c.length;if(0<f){b.enctype="multipart/form-data";for(h=0;h<f;h++)a=c[h],e=a.parentNode,g=a.cloneNode(),g.disabled="disabled",j.push([a,
g,e]),e.insertBefore(g,a),b.appendChild(a)}a=e=g=null;b.submit();this.state=2;this.frame.contentWindow&&(this.frame.contentWindow.name=this.options.defaultName)},isObject:function(d){return"[object Object]"==Object.prototype.toString.call(d)},isArray:function(d){return"[object Array]"==Object.prototype.toString.call(d)},extend:function(d,a){var c,b;for(c in a)a.hasOwnProperty(c)&&(b=a[c],b=this.isArray(b)?this.copyArray(b):this.isObject(b)?this.extend({},b):b,d[c]=b);return d},copyArray:function(d){for(var a=
[],c=0,b=d.length,e;c<b;c++)e=d[c],this.isArray(e)?a.push(this.copyArray(e)):this.isObject(e)?a.push(this.extend({},e)):a.push(e);return a}};
