function Transfer(c,a,b){this.url=c;this.callback=a;this.options=this.extend({localProxy:"/favicon.ico",defaultName:"cross.default.name"},b);this.init()}
Transfer.prototype={init:function(){this.params=this.options.params||{};this.params.windowname=1;delete this.options.params;this.files=this.options.files||[];delete this.options.files;var c="transfer_"+(new Date).getTime(),a;a=null;try{a=document.createElement('<iframe name="'+c+'">')}catch(b){}if(!a||"IFRAME"!=a.nodeName)a=document.createElement("iframe"),a.name=c;a.name=c;a.style.display="none";a.style.position="fixed";a.style.top=a.style.left="-10000px";document.body.appendChild(a);var d=document.createElement("form");
d.style.display="none";d.target=c;d.action=this.url;d.method="post";d.encoding=d.enctype="application/x-www-form-urlencoded";document.body.appendChild(d);this.frame=a;this.form=d;this.state=1;this._setRequest()},_setRequest:function(){function c(){try{if("about:blank"==b.contentWindow.location.href)return}catch(c){}if(3==a.state){var e=!1;try{e=b.contentWindow.location.host==location.host}catch(h){}if(e){if(b.readyState&&"complete"!=b.readyState.toLowerCase())return;e=b.contentWindow.name;e==g.defaultName&&
(e='{"error": 1}');a.callback(e);b.onreadystatechange=b.onload=null;b.parentNode.removeChild(b);if(d){for(var i=0,l=a._files.length;i<l;i++)e=a._files[i],e[2].insertBefore(e[0],e[1]),e[2].removeChild(e[1]);a._files=[];d.parentNode.removeChild(d)}d=b=null;for(var k in a)a.hasOwnProperty(k)&&(a[k]=null,delete a[k])}else b.contentWindow.location=f}2==a.state&&(b.contentWindow.location=f,a.state=3)}var a=this,b=a.frame,d=a.form,g=a.options,f=g.localProxy;void 0!==b.onreadystatechange?b.onreadystatechange=
c:b.onload=c},send:function(){function c(a,b){var c=document.createElement("input");c.name=a;c.value=b;return c}var a=this.params,b=this.files,d=this.form,g,f,j=Object.prototype.toString;for(g in a)if(a.hasOwnProperty(g))if(f=a[g],"[object Array]"===j.call(f))for(var e=g+"[]",h=0,i=f.length;h<i;h++)d.appendChild(c(e,f[h]));else d.appendChild(c(g,f));j=this._files=[];e=b.length;if(0<e){d.encoding=d.enctype="multipart/form-data";for(h=0;h<e;h++)a=b[h],g=a.parentNode,f=a.cloneNode(),f.disabled="disabled",
j.push([a,f,g]),g.insertBefore(f,a),d.appendChild(a)}a=g=f=null;d.submit();this.state=2;this.frame.contentWindow&&(this.frame.contentWindow.name=this.options.defaultName)},isObject:function(c){return"[object Object]"==Object.prototype.toString.call(c)&&!c.nodeType},isArray:function(c){return"[object Array]"==Object.prototype.toString.call(c)},extend:function(c,a){var b=this.clone(a),d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c},clone:function(c){var a;if(this.isArray(c)){a=[];for(var b=
0,d=c.length;b<d;b++)a.push(this.clone(c[b]))}else if(this.isObject(c))for(b in a={},c)c.hasOwnProperty(b)&&(a[b]=this.clone(c[b]));else a=c;return a}};
